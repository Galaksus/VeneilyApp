<!DOCTYPE html>
<html>

<head>
    <title>VeneilyApp</title>
    <link rel="stylesheet" href="stylesheet.css">
    <link rel="stylesheet" href="dialogs.css">
    <link rel="stylesheet" href="nameDialog.css">
    <link rel="stylesheet" href="bottomBarStyles.css">
    <link rel="stylesheet" href="messageLogger.css">


    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>

<body>
    <div id="map-container">
        <div id="map"></div>
        <img src="icons/delete-icon-black.svg" id="delete-draggable-marker" class="center-div" style="display: none;">

        <!-- Shown only when permission is not granted for location updates -->
        <div id="location-permission-required-label" style="display: none;">
            <p>Location permission is required for the app to function properly</p>
        </div>

        <!--- Toast Message element-->
        <div class="toast" id="toast" style="display: none;">
            <img src="icons/app-icon.png" alt="Icon" class="toast-icon">
            <span id="toast-text"></span>
            <span class="toast-close-button"
            onclick="hideToast()">&#10006;</span>
        </div>
        
        <!-- Bottom navigatiom bar -->
        <div class="gradient-element">

            <div class="svg-button default-display-none" id="" onclick="NewRouteButtonFunction()">
                <img class="svg-image"src="icons/go-back.svg" alt="New route">
                <p class="menu-text" id="">Home</p>
            </div>

            <div class="svg-button" onclick="openDialog(document.getElementById('menu-dialog'))">
              <img class="svg-image" src="icons/menu-icon.svg" alt="Menu Icon">
              <p class="menu-text">Menu</p>
            </div>

            <div class="svg-button" id="center-me-button"> 
              <img class="svg-image" id="center-me-button-src" src="icons/center-me-normal.svg" alt="Delete Icon">
              <p class="menu-text">Center</p>
            </div>
            <div class="svg-button" onclick="MoreButtonsFunction()">
                <img class="svg-image" id="" src="icons/more-icon.svg" alt="Bluetooth icon">  <!-- TODO TEE ID KUNTOON-->
                <p class="menu-text">More</p>
            </div>

            <div class="svg-button default-display-none" id="save-button" onclick="SaveButtonFunction()">
              <img class="svg-image-2" src="icons/save.svg" alt="Save Icon">
              <p class="menu-text">Save</p>
            </div>

            <div class="svg-button default-display-none" id="draw-button" onclick="DrawButtonFunction()">
                <img class="svg-image" src="icons/route-type-path.svg" alt="Route type Icon">
                <p class="menu-text"id="path-type">Type: path</p>
              </div>
        
            <div class="svg-button default-display-none" onclick="RevertButtonFunction()">
              <img class="svg-image-2" src="icons/revert.svg" alt="Revert Icon">
              <p class="menu-text">Revert</p>
            </div>
          </div>
 
          <!-- Extra buttons that are revealed when "More" Button is clicked -->
          <div id="button-navigation-dialog" class="default-dialog" onclick="closeDialog(this);">
            <div class="dialog-container" id="button-navigation-dialog-container" onclick="event.stopPropagation();">
                <div class="dialog-header-content" id="button-navigation-dialog-header-content">
                    <span class="close-dialog-button"
                    onclick="closeDialog(document.getElementById('button-navigation-dialog'))">&#10006;</span>

                    <div class="svg-buttons-container">
                        <div class="svg-button" id="routes-select-container">
                            <img class="svg-image" src="icons/old-routes.svg" alt="Old routes Icon">
                            <p class="menu-text">My routes</p>
                        </div>

                        <div class="svg-button" id="new-route-button" onclick="NewRouteButtonFunction()">
                            <img class="svg-image"src="icons/new-gray.svg" alt="New route">
                            <p class="menu-text" id="new-route-text"> New route</p>
                        </div>

                        <div class="svg-button" id="bluetooth-icon">
                            <img class="svg-image"  src="icons/bluetooth-icon.svg" alt="Bluetooth icon">
                            <p class="menu-text">Bluetooth</p>
                        </div>

                        <div class="svg-button" onclick="settingsButtonFunction()">
                            <img class="svg-image" id="settings-icon-button" src="icons/settings-icon.svg" alt="Settings icon">
                            <p class="menu-text">Settings</p>
                        </div>
                        
                        <div class="svg-button" id="messages-button">
                            <img class="svg-image" id="messages-button-src" src="icons/message-alert-icon.svg" alt="Messages Icon">
                            <p class="menu-text">Messages</p>
                        </div>

                        <div class="svg-button" id="delete-button" style="display: none;">
                            <img class="svg-image" src="icons/delete-icon.svg" alt="Delete Icon">
                            <p class="menu-text">Delete</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Routes select dropdown dialog -->
    <div id="dropdown-dialog" class="default-dialog" onclick="closeDialog(this);">
        <div class="dialog-container" onclick="event.stopPropagation();">
            <!-- Header content -->
            <div class="dialog-header-content">
                Select a route
                <span class="close-dialog-button"
                onclick="closeDialog(document.getElementById('dropdown-dialog'))">&#10006;</span>
            </div>
            <div class="dialog-content" id="dropdown-dialog-content">
            </div>
            <div id="ok-button-container">
                <button class="button-class border-radius-20px" id="select-ok-button">OK</button>
            </div>
        </div>
        
    </div>

    <!-- The 'Are you sure' dialog container -->
    <div id="are-you-sure-dialog" class="default-dialog" onclick="closeDialog(this);">
        <div class="dialog-container" onclick="event.stopPropagation();">
            <!-- Header content -->
            <div class="dialog-header-content">
                Are you sure you want to delete this route?
                <span class="close-dialog-button"
                onclick="closeDialog(document.getElementById('are-you-sure-dialog'))">&#10006;</span>
            </div>
            <div class="dialog-content">
                <!-- Input and buttons container -->
                <div class="input-buttons-container-class" id="input-buttons-container">
                    <div class="name-buttons-class name-buttons-class-2">
                        <button class="dialog-ok-cancel-buttons" onclick="cancelClickOnAreYouSurePrompt()">Cancel</button>
                        <button class="dialog-ok-cancel-buttons" onclick="OKClickOnAreYouSurePrompt()">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- The bluetooth dialog container -->
    <div id="bluetooth-dialog" class="default-dialog" onclick="closeDialog(this);">
        <div class="dialog-container" onclick="event.stopPropagation();">
            <!-- Header content -->
            <div class="dialog-header-content">
                Bluetooth
                <span class="close-dialog-button"
                onclick="closeDialog(document.getElementById('bluetooth-dialog'))">&#10006;</span>
            </div>
            <div class="dialog-content">
                <div id="bluetooth-connection-state" Type>
                    <span id="connection-state-text"> </span>
                </div>
                <div class="center-div">
                    <button id="connect-bluetooth-button" class="button-class border-radius-20px">Connect</button>
                </div>
            </div>
        </div>
    </div>
        <!-- The dialog container -->
        <div id="settings-dialog" class="default-dialog" onclick="closeDialog(this);">
            <div class="dialog-container" onclick="event.stopPropagation();">
                <!-- Header content -->
                <div class="dialog-header-content">
                    Settings
                    <span class="close-dialog-button"
                        onclick="closeDialog(document.getElementById('settings-dialog'))">&#10006;</span>
                </div>
                <!-- Scrollable dialog content -->
                <div class="dialog-content">
                    <!-- scrollable content -->
                    <div class="settings-pane">
                        <h3>General settings</h3>

                    <!-- Switch 1 -->
                    <label class="toggle-switch">
                        <span class="text-element">Use Android GPS</span>
                            <input type="checkbox" id="Switch-GPS">
                            <span class="toggle-slider"></span>
                    </label>

                    <!-- Switch 2 -->
                    <label class="toggle-switch">
                        <span class="text-element">Use Android orientation</span>
                            <input type="checkbox" id="Switch-orientation">
                            <span class="toggle-slider"></span>
                    </label>

                    <!-- Switch 3 -->
                    <label class="toggle-switch">
                        <span class="text-element">Remove/Add OpenSeaMap tile</span>
                            <input type="checkbox" id="Switch-OpenSeaMap-tile">
                            <span class="toggle-slider"></span>
                    </label>
                </div>
                    <div class="settings-pane">
                        <h3>Auto Mode
                            <img class="info-icon" src="icons/info-icon.svg" alt="Info" onclick="showPopup('auto-mode-info')">
                        </h3>
                        <span class="text-element">Maximum distance between current location and interpolated point, a lower value has more effect on the rotation of servo</span>
                        <div class="input-container">
                            <input type="number" min="0" max="100" value="8" step="0.01" id="distance-to-interpolated-point-max">
                            <label for="distance-to-interpolated-point-max">m</label>
                        </div>
                        <div id="auto-mode-info" class="info-popup">
                            <span class="close-info-popup" style="color: #333;"
                            onclick="closeDialog(document.getElementById('auto-mode-info'))">&#10006;</span>
                            <p>Info about auto mode.</p>
                        </div>
                    </div>
                    <div class="settings-pane">
                        <h3>PID parameters
                            <img class="info-icon" src="icons/info-icon.svg" alt="Info" onclick="showPopup('pidInfo')">
                        </h3>
                        <div class="pid-input-container">
                            <label for="kP">kP:</label>
                            <input type="number" id="kP" name="kP" step="0.01" value="0.00" id="kP">
                        </div>
                        <div class="pid-input-container">
                            <label for="kI">kI:</label>
                            <input type="number" id="kI" name="kI" step="0.01" value="0.00" id="kI">
                        </div>
                        <div class="pid-input-container">
                            <label for="kD">kD:</label>
                            <input type="number" id="kD" name="kD" step="0.01" value="0.00" id="kD">
                        </div>
                        <div class="pid-input-container">
                            <label for="dT">dT:</label>
                            <input type="number" id="dT" name="dT" step="0.01" value="0.00" id="dT">
                        </div>
                        <div id="pidInfo" class="info-popup">
                            <span class="close-info-popup" style="color: #333;" onclick="closeDialog(document.getElementById('pidInfo'))">&#10006;</span>
                            <h2>PID Controller Information</h2>
                            <p><strong>kP (Proportional Gain):</strong></p>
                            <p>Determines immediate response strength to current error. Higher values lead to faster but potentially more oscillatory response. Lower values result in smoother response but may be slower or cause steady-state error.</p>
                            
                            <p><strong>kI (Integral Gain):</strong></p>
                            <p>Considers accumulation of past errors over time to eliminate steady-state error. Higher values eliminate error faster but can lead to instability. Lower values may result in slower error elimination or persistent error.</p>
                            
                            <p><strong>kD (Derivative Gain):</strong></p>
                            <p>Accounts for rate of change of error to dampen system response. Higher values reduce overshoot and oscillations but may cause instability. Lower values allow more oscillations and overshoot.</p>
                            
                            <p><strong>dT (Sampling Time):</strong></p>
                            <p>Controller update interval. Smaller values allow quicker response but may increase computational load. Larger values slow response but reduce computational load.</p>
                        </div>
                        
                    </div>

                </div>
                <div class="bottom-bar-content">
                    <div class="center-div">
                        <button id="save-settings-button" class="button-class border-radius-20px">Save settings</button>
                    </div>
                </div>
            </div>
        </div>

    <!-- The messages dialog container -->
    <div id="message-dialog" class="default-dialog" onclick="closeDialog(this);">
        <div class="dialog-container" onclick="event.stopPropagation();">
            <!-- Header content -->
            <div class="dialog-header-content">
                Message log
                <span class="close-dialog-button"
                onclick="closeDialog(document.getElementById('message-dialog'))">&#10006;</span>
            </div>
            <div class="dialog-content" style="padding: 0px;">
                <div id="message-dialog-widget-container">
                    <select class="button-class" id="filter" onchange="filterMessages()">
                        <option value="all">All</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                <button class="button-class" id="clear-messages-button"  onclick="clearMessages()">Clear Messages</button>
                <hr class="line-1" color="gray" size="2">

                </div>
            </div>
            <div id="messages-container">
                <div id="messages"></div>
                <div id="placeholder-message">No messages at the moment</div>
        </div>
        </div>
    </div>

        <!-- The menu dialog container -->
        <div id="menu-dialog" class="default-dialog" onclick="closeDialog(this)">
            <div class="dialog-container" onclick="event.stopPropagation();">
                <!-- Header content -->
                <div class="dialog-header-content" id="menu-header-content">
                    Controls
                    <span class="close-dialog-button"
                        onclick="closeDialog(document.getElementById('menu-dialog'))">&#10006;</span>
                    <!-- &#10006; means "x" symbol -->
                </div>
                                <!-- Auto mode-->
                                <div id="menu-dialog-content-auto-mode" style="display: block;">
                                    <!-- scrollable content -->
                                    <div class="auto-mode-info-data">
                                        <p id="auto-mode-selected-route"> Selected route:</p>
                                        <span class="margin-left-5" id="dynamicText-route-name"> </span>
                                    </div>
                                    <hr width="100%" />
                                    <div class="auto-mode-info-data">
                                        <p>Type: </p>
                                        <span class="margin-left-5" id="dynamicText-type"> </span>
                                    </div>
                                    <div class="auto-mode-info-data">
                                        <p>Total length: </p>
                                        <span class="margin-left-5" id="dynamicText-total-length"> </span>
                                    </div>
                                    <div class="auto-mode-info-data">
                                        <p>Checkpoints: </p>
                                        <span class="margin-left-5" id="dynamicText-checkpoints"> </span>
                                    </div>
                                    <!-- Not implemented yet (Not the most necessary thing :D)
                                     <div class="auto-mode-info-data">
                                        <p>Completed: </p>
                                        <span id="dynamicText-completed"> moi</span>
                                    </div> -->
                                    <div class="center-div">
                                        <button id="start-route-button" class="button-class border-radius-20px">Start</button>
                                    </div>
                                    <div id="start-route-text" class="align-text" style="display: none; color: green;">
                                        <p>Route started</p>
                                    </div>
                    <hr class="line-1" color="gray" size="2">

                                </div>
                <!-- Scrollable dialog content -->
                <div class="enabled" id="menu-dialog-content-manual-mode">

                    <div class="align-text align-radio-buttons">
                        <label id="backward-text-label" >Bwd</label><br>
                        <input type="radio" id="backward" name="direction" value="backward" onchange="fwdBwdRadioButtonChanged()">
                        <p>Motor speed control</p>
                        <input type="radio" id="forward" name="direction" value="forward" checked onchange="fwdBwdRadioButtonChanged()">
                        <label for="forward" id="forward-text-label" >Fwd</label><br>
                    </div>

                    <div class="slider-container">
                        <output for="manual-motor-speed-slider" id="manual-motor-speed-slider-value">0</output>
                        <input type="range" class="range-slider" min="0" max="100" value="0"
                            id="manual-motor-speed-slider">
                    </div>
                    <div class="minus-plus-icon-container">

                    <img src="icons/minus-icon.svg" class="minus-svg-icon" id="minus-svg-icon-speed" width="24" height="24"
                        onclick="rangeSliderArithmetic(this, false);">
                    <img src="icons/plus-icon.svg" class="plus-svg-icon" id="plus-svg-icon-speed" width="24" height="24"
                        onclick="rangeSliderArithmetic(this, true);">
                    </div>

                    <hr class="line-1" color="gray" size="2">

                    <div class="align-text">
                        <p>Motor steering control</p>
                    </div>
                    <div class="slider-container">
                        <output for="manual-steering-slider" id="manual-steering-slider-value">50</output>
                        <input type="range" class="range-slider" min="0" max="100" value="50"
                            id="manual-steering-slider">
                    </div>
                    <div class="minus-plus-icon-container">
                        <img src="icons/minus-icon.svg" class="minus-svg-icon" id="minus-svg-icon-steer" width="24" height="24"
                            onclick="rangeSliderArithmetic(this, false);">
                        <img src="icons/plus-icon.svg" class="plus-svg-icon" id="plus-svg-icon-steer" width="24" height="24"
                            onclick="rangeSliderArithmetic(this, true);">
                    </div>
                    <hr class="line-1" color="gray" size="2">

                    <div class="menu-button-container">
                        <button id="lock-direction-button" class="button-class  border-radius-20px">Lock direction</button>
                        <button id="anchor-button" class="button-class  border-radius-20px">Set anchor</button>
                    </div>
                    <div id="lock-and-anchor-text" class="align-text" style="display: none; color: green;">
                        <p>Current direction is now locked</p>
                    </div>

                </div>
                <div class="bottom-bar-content">
                </div>
            </div>
        </div>
    </div>
    <div id="overlay" class="hidden"></div>
    <!-- The name dialog container -->
    <div id="name-dialog" onclick="closeDialog(this);">
        <div id="name-dialog-container" onclick="event.stopPropagation();">
            <!-- Header content -->
            <div id="name-header-content">
                Enter a name
            </div>
            <!-- Input and buttons container -->
            <div class="input-buttons-container-class">
                <input type="text" id="name-input" placeholder="Name" />
                <div class="name-buttons-class">
                    <button class="dialog-ok-cancel-buttons" id="name-cancel-button">Cancel</button>
                    <button class="dialog-ok-cancel-buttons" id="name-ok-button">OK</button>
                </div>
            </div>
        </div>
    </div>
    <script src="route.js"></script>
    <script src="dialogs.js"></script>
    <script src="readDb.js"></script>
    <script src="deleteRouteFromDb.js"></script>
    <script src="nameDialog.js"></script>
    <script src="LocationOrientation.js"></script>
    <script src="styles.js"></script>
    <script src="settings.js"></script>
    <script src="messageLogger.js"></script>


    </div>
</body>

</html>